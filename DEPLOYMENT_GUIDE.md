# üöÄ Backend Deployment to Render - Step by Step Guide

## üìã Pre-Deployment Checklist

### 1. Qdrant Cloud Setup (If not done already)
- Go to: https://cloud.qdrant.io/
- Create a free cluster
- Get your:
  - Cluster URL (e.g., `https://xyz-example.cloud.qdrant.io:6333`)
  - API Key
- Collection name: `robotics_book`

### 2. Prepare Your Environment Variables
You'll need these ready:
- `QDRANT_URL` - Your Qdrant Cloud cluster URL
- `QDRANT_API_KEY` - Your Qdrant API key
- `GOOGLE_API_KEY` - Your Google Gemini API key
- `SECRET_KEY` - Will be auto-generated by Render
- `ALLOWED_ORIGINS` - Already set to your Netlify URL

---

## üîß Step 1: Push Backend to GitHub

```powershell
# Make sure you're in the backend directory
cd backend

# Add the new files
git add .

# Commit
git commit -m "Add Render deployment configuration"

# Push to GitHub
git push origin master
```

---

## üåê Step 2: Deploy on Render

### Option A: Using Blueprint (Automated - Recommended)

1. Go to: https://dashboard.render.com/
2. Click **"New +"** ‚Üí **"Blueprint"**
3. Connect your GitHub account
4. Select repository: `AI-AND-ROBOT-BOOK4-BACKEND` (create this repo)
5. Render will detect `render.yaml` and configure everything automatically
6. Add your environment variables when prompted:
   - `QDRANT_URL`
   - `QDRANT_API_KEY`
   - `GOOGLE_API_KEY`
7. Click **"Apply"**

### Option B: Manual Setup

1. Go to: https://dashboard.render.com/
2. Click **"New +"** ‚Üí **"Web Service"**
3. Connect GitHub and select your backend repository
4. Configure:
   - **Name:** `ai-robotics-book-backend`
   - **Region:** Oregon (US West)
   - **Branch:** `master`
   - **Root Directory:** Leave blank
   - **Runtime:** Python 3
   - **Build Command:** `pip install --upgrade pip && pip install -r requirements.txt`
   - **Start Command:** `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
   - **Plan:** Free

5. **Environment Variables** (click "Advanced"):
   ```
   PYTHON_VERSION = 3.11.0
   QDRANT_URL = [your_qdrant_cloud_url]
   QDRANT_API_KEY = [your_qdrant_api_key]
   QDRANT_COLLECTION_NAME = robotics_book
   GOOGLE_API_KEY = [your_gemini_api_key]
   SECRET_KEY = [click "Generate" or paste your own]
   ALGORITHM = HS256
   ACCESS_TOKEN_EXPIRE_MINUTES = 30
   DEBUG = False
   ALLOWED_ORIGINS = https://ai-and-robot-book4-frontend.netlify.app
   ```

6. Click **"Create Web Service"**

---

## üìä Step 3: Index Your Book Content to Qdrant

After deployment succeeds:

1. **Update your local `.env`** with Qdrant Cloud credentials
2. **Run the indexing script locally:**
   ```powershell
   python index_book_to_qdrant.py
   ```
   This will populate your Qdrant Cloud collection with the book content.

---

## üîó Step 4: Connect Frontend to Backend

1. Go to Netlify Dashboard ‚Üí Your site
2. **Site settings** ‚Üí **Environment variables**
3. Add/Update:
   - **Key:** `VITE_API_URL`
   - **Value:** `https://your-backend-name.onrender.com`
4. Click **"Trigger deploy"** to redeploy

---

## ‚úÖ Step 5: Verify Deployment

1. **Check backend health:**
   - Visit: `https://your-backend-name.onrender.com/health`
   - Should return: `{"status": "healthy"}`

2. **Check API docs:**
   - Visit: `https://your-backend-name.onrender.com/docs`
   - You should see the FastAPI Swagger UI

3. **Test the chat:**
   - Go to your Netlify site
   - Navigate to the chat page
   - Ask a question about the book
   - Should get AI-powered responses with citations!

---

## üêõ Troubleshooting

### Build Fails
- Check Render logs for specific errors
- Verify `requirements.txt` has all dependencies
- Check Python version in `runtime.txt`

### App Crashes
- Check environment variables are set correctly
- Verify Qdrant Cloud is accessible
- Check CORS settings in `main.py`

### Chat Not Working
- Verify `VITE_API_URL` in Netlify matches your Render URL
- Check browser console for CORS errors
- Verify Qdrant collection has data (run `check_qdrant.py`)

---

## üìù Important Notes

1. **Free tier limitations:**
   - Render free tier spins down after 15 min of inactivity
   - First request after spin-down takes ~30-60 seconds
   - Consider upgrading for production use

2. **Qdrant Cloud free tier:**
   - 1GB storage
   - Good for your book content
   - Upgrade if you add more data

3. **CORS Configuration:**
   - Already set to your Netlify URL
   - Add more origins if needed in environment variables

---

## üéâ Success!

Once everything is deployed:
- ‚úÖ Frontend: https://ai-and-robot-book4-frontend.netlify.app/
- ‚úÖ Backend: https://your-backend-name.onrender.com/
- ‚úÖ Chat works with RAG-powered responses
- ‚úÖ Auto-deploys on git push

Happy deploying! üöÄ
